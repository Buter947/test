<div id="jp-name-converter-app">
    <style>
        /* --- ä¸»æ‡‰ç”¨ç¨‹å¼å®¹å™¨ --- */
        #jp-name-converter-app {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif !important;
            max-width: 700px !important;
            margin: 2rem auto !important;
            background-color: #ffffff !important; /* æ”¹ç‚ºæ›´ä¹¾æ·¨çš„ç™½è‰²èƒŒæ™¯ */
            padding: 2.5rem !important;
            border-radius: 1rem !important; /* å¢åŠ åœ“è§’åŠå¾‘ */
            border: 1px solid #e5e7eb !important;
            box-shadow: 0 10px 25px -5px rgba(0, 0, 0, 0.05), 0 10px 10px -5px rgba(0, 0, 0, 0.04) !important;
        }
        #jp-name-converter-app *,
        #jp-name-converter-app *::before,
        #jp-name-converter-app *::after {
            box-sizing: border-box !important;
        }

        /* --- è¼¸å…¥å€ --- */
        #jp-name-converter-app .input-area {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 1.5rem;
            margin-bottom: 1.5rem;
        }
        #jp-name-converter-app .input-group {
            display: flex;
            flex-direction: column;
            gap: 0.5rem;
        }
        #jp-name-converter-app .input-label {
            font-weight: 600;
            color: #B45309;
            font-size: 0.9rem;
            padding-left: 0.25rem;
        }
        #jp-name-converter-app .name-input {
            width: 100% !important;
            padding: 1rem !important;
            font-size: 1.1rem !important;
            border: 1px solid #d1d5db !important;
            border-radius: 0.5rem !important;
            transition: all 0.2s;
        }
        #jp-name-converter-app .name-input:focus {
            outline: none !important;
            border-color: #B45309 !important;
            box-shadow: 0 0 0 3px rgba(180, 83, 9, 0.2) !important;
        }

        /* --- æŒ‰éˆ•å€ --- */
        #jp-name-converter-app .button-area {
            display: flex;
            justify-content: center;
            gap: 1rem;
            margin-bottom: 2rem;
        }
        #jp-name-converter-app .action-btn {
            border: none;
            padding: 0.75rem 2rem;
            font-size: 1.1rem;
            font-weight: 600;
            border-radius: 0.5rem;
            cursor: pointer;
            transition: all 0.2s;
        }
        #jp-name-converter-app #convert-btn {
            background-color: #B45309 !important;
            color: #ffffff !important;
        }
        #jp-name-converter-app #convert-btn:hover { background-color: #9a4708 !important; }
        #jp-name-converter-app #clear-btn {
            background-color: #e5e7eb !important;
            color: #4b5563 !important;
        }
        #jp-name-converter-app #clear-btn:hover { background-color: #d1d5db !important; }

        /* --- çµæœå€ --- */
        #jp-name-converter-app .results-section {
            background-color: #f9fafb; /* çµ¦çµæœå€å¡Šä¸€å€‹æ·¡æ·¡çš„èƒŒæ™¯è‰² */
            border: 1px solid #e5e7eb;
            border-radius: 0.75rem; /* å¢åŠ åœ“è§’ */
            padding: 0.5rem 1.5rem;
            margin-bottom: 1rem;
        }
        #jp-name-converter-app .result-item {
            display: grid;
            /* æ¡Œé¢ç‰ˆä½ˆå±€ï¼šæ¨™ç±¤ã€çµæœã€æŒ‰éˆ•ç¾¤çµ„ */
            grid-template-columns: 100px 1fr auto; 
            align-items: center;
            gap: 1.5rem; /* å¢åŠ é–“è· */
            padding: 1rem 0;
            border-bottom: 1px solid #e5e7eb;
        }
        #jp-name-converter-app .result-item:last-child { border-bottom: none; }
        
        #jp-name-converter-app .result-label {
            font-weight: 600;
            color: #4b5563;
        }
        #jp-name-converter-app .result-text {
            font-size: 1.3rem; /* ç¨ç‚ºæ”¾å¤§å‡åæ–‡å­— */
            font-weight: 500;
            color: #111827;
            background-color: #ffffff;
            padding: 0.5rem 1rem;
            border-radius: 0.375rem;
            word-break: break-all;
            text-align: center; /* ç½®ä¸­é¡¯ç¤ºæ›´ç¾è§€ */
        }
        /* ã€æ–°å¢ã€‘æŒ‰éˆ•å®¹å™¨ */
        #jp-name-converter-app .result-actions {
            display: flex;
            gap: 0.75rem; /* èª¿æ•´æŒ‰éˆ•é–“è· */
        }
        #jp-name-converter-app .result-btn {
            width: 40px; height: 40px; /* ç¨å¾®åŠ å¤§æŒ‰éˆ• */
            border-radius: 50%;
            border: 1px solid #d1d5db;
            background-color: #ffffff;
            color: #6b7280;
            cursor: pointer;
            display: flex; justify-content: center; align-items: center;
            font-size: 1.2rem; /* æ”¾å¤§åœ–ç¤º */
            transition: all 0.2s;
        }
        #jp-name-converter-app .result-btn:hover {
            background-color: #f3f4f6;
            color: #111827;
        }

        /* --- æç¤ºè¨Šæ¯ --- */
        #jp-name-converter-app .feedback-message {
            text-align: center;
            padding: 0.75rem;
            border-radius: 0.5rem;
            margin-bottom: 1.5rem;
            display: none; /* é è¨­éš±è— */
            font-weight: 500;
        }
        #jp-name-converter-app .feedback-message.error {
            background-color: #fee2e2 !important;
            color: #b91c1c !important;
        }
        #jp-name-converter-app .feedback-message.success {
            background-color: #dcfce7 !important;
            color: #166534 !important;
        }

        /* --- éŸ¿æ‡‰å¼è¨­è¨ˆ --- */
        @media (max-width: 640px) {
            #jp-name-converter-app {
                padding: 1.5rem !important;
            }
            #jp-name-converter-app .input-area {
                grid-template-columns: 1fr;
                gap: 1rem;
            }
            #jp-name-converter-app .results-section {
                padding: 0.5rem 1rem;
            }
            /* ã€é—œéµä¿®å¾©ã€‘è¡Œå‹•ç‰ˆçµæœå€å¡Šä½ˆå±€ */
            #jp-name-converter-app .result-item {
                grid-template-columns: 1fr; /* æ”¹ç‚ºå–®æ¬„ä½ˆå±€ */
                gap: 0.75rem; /* èª¿æ•´å‚ç›´é–“è· */
                padding: 1rem 0;
            }
            #jp-name-converter-app .result-label {
                font-size: 0.9rem;
            }
            #jp-name-converter-app .result-actions {
                justify-content: flex-end; /* æŒ‰éˆ•é å³å°é½Š */
            }
        }
    </style>

    <div id="jp-name-converter-app">
        <div class="input-area">
            <div class="input-group">
                <label for="last-name" class="input-label">Last Name</label>
                <input type="text" id="last-name" class="name-input" placeholder="e.g. Chan">
            </div>
            <div class="input-group">
                <label for="first-name" class="input-label">First Name</label>
                <input type="text" id="first-name" class="name-input" placeholder="e.g. Tai Man">
            </div>
        </div>

        <div id="validation-feedback" class="feedback-message"></div>

        <div class="button-area">
            <button id="convert-btn" class="action-btn">Convert</button>
            <button id="clear-btn" class="action-btn">Clear</button>
        </div>

        <div id="results-area" style="display: none;">
            <div id="last-name-results" class="results-section">
                 <div class="result-item">
                     <span class="result-label">Last Name (Hiragana)</span>
                     <span id="last-hiragana-result" class="result-text"></span>
                     <div class="result-actions">
                         <button class="result-btn copy-btn" data-target="last-hiragana-result" title="Copy">ğŸ“‹</button>
                         <button class="result-btn speech-btn" data-target="last-hiragana-result" title="Pronounce">ğŸ”Š</button>
                     </div>
                 </div>
                 <div class="result-item">
                     <span class="result-label">Last Name (Katakana)</span>
                     <span id="last-katakana-result" class="result-text"></span>
                     <div class="result-actions">
                         <button class="result-btn copy-btn" data-target="last-katakana-result" title="Copy">ğŸ“‹</button>
                         <button class="result-btn speech-btn" data-target="last-katakana-result" title="Pronounce">ğŸ”Š</button>
                     </div>
                 </div>
            </div>
            <div id="first-name-results" class="results-section">
                 <div class="result-item">
                     <span class="result-label">First Name (Hiragana)</span>
                     <span id="first-hiragana-result" class="result-text"></span>
                     <div class="result-actions">
                         <button class="result-btn copy-btn" data-target="first-hiragana-result" title="Copy">ğŸ“‹</button>
                         <button class="result-btn speech-btn" data-target="first-hiragana-result" title="Pronounce">ğŸ”Š</button>
                     </div>
                 </div>
                 <div class="result-item">
                     <span class="result-label">First Name (Katakana)</span>
                     <span id="first-katakana-result" class="result-text"></span>
                     <div class="result-actions">
                         <button class="result-btn copy-btn" data-target="first-katakana-result" title="Copy">ğŸ“‹</button>
                         <button class="result-btn speech-btn" data-target="first-katakana-result" title="Pronounce">ğŸ”Š</button>
                     </div>
                 </div>
            </div>
        </div>
    </div>

<script>
(function() {
    document.addEventListener('DOMContentLoaded', function() {
        const app = document.getElementById('jp-name-converter-app');
        if (!app) return;

        // å…ƒç´ é¸æ“‡
        const lastNameInput = app.querySelector('#last-name');
        const firstNameInput = app.querySelector('#first-name');
        const convertBtn = app.querySelector('#convert-btn');
        const clearBtn = app.querySelector('#clear-btn');
        const resultsArea = app.querySelector('#results-area');
        const validationFeedback = app.querySelector('#validation-feedback');

        // è³‡æ–™åº«
        const surnameMap = { 'chan': { katakana: 'ãƒãƒ£ãƒ³', hiragana: 'ã¡ã‚ƒã‚“' }, 'chen': { katakana: 'ãƒã‚§ãƒ³', hiragana: 'ã¡ã‡ã‚“' }, 'lam': { katakana: 'ãƒ©ãƒ ', hiragana: 'ã‚‰ã‚€' }, 'lin': { katakana: 'ãƒªãƒ³', hiragana: 'ã‚Šã‚“' }, 'wong': { katakana: 'ã‚¦ã‚©ãƒ³', hiragana: 'ã†ã‰ã‚“' }, 'huang': { katakana: 'ãƒ›ã‚¡ãƒ³', hiragana: 'ã»ãã‚“' }, 'cheung': { katakana: 'ãƒãƒ§ãƒ³', hiragana: 'ã¡ã‚‡ã‚“' }, 'chang': { katakana: 'ãƒãƒ£ãƒ³', hiragana: 'ã¡ã‚ƒã‚“' }, 'lee': { katakana: 'ãƒªãƒ¼', hiragana: 'ã‚Šãƒ¼' }, 'li': { katakana: 'ãƒª', hiragana: 'ã‚Š' }, 'ng': { katakana: 'ãƒ³', hiragana: 'ã‚“' }, 'wu': { katakana: 'ã‚¦ãƒ¼', hiragana: 'ã†ãƒ¼' }, 'lau': { katakana: 'ãƒ©ã‚¦', hiragana: 'ã‚‰ã†' }, 'liu': { katakana: 'ãƒªãƒ¥ã‚¦', hiragana: 'ã‚Šã‚…ã†' }, 'choi': { katakana: 'ãƒãƒ§ã‚¤', hiragana: 'ã¡ã‚‡ã„' }, 'tsoi': { katakana: 'ãƒ„ã‚©ã‚¤', hiragana: 'ã¤ã‰ã„' }, 'tsai': { katakana: 'ãƒ„ã‚¡ã‚¤', hiragana: 'ã¤ãã„' }, 'yeung': { katakana: 'ãƒ¨ãƒ³', hiragana: 'ã‚ˆã‚“' }, 'yang': { katakana: 'ãƒ¤ãƒ³', hiragana: 'ã‚„ã‚“' }, 'hui': { katakana: 'ãƒ›ã‚¤', hiragana: 'ã»ã„' }, 'hsu': { katakana: 'ã‚·ãƒ¥ãƒ¼', hiragana: 'ã—ã‚…ãƒ¼' }, 'cheng': { katakana: 'ãƒã‚§ãƒ³', hiragana: 'ã¡ã‡ã‚“' }, 'tse': { katakana: 'ãƒ„ã‚§', hiragana: 'ã¤ã‡' }, 'che': { katakana: 'ãƒã‚§', hiragana: 'ã¡ã‡' }, 'hsieh': { katakana: 'ã‚·ã‚§', hiragana: 'ã—ã‡' }, 'kwok': { katakana: 'ã‚¯ã‚©ã‚¯', hiragana: 'ãã‰ã' }, 'kuo': { katakana: 'ã‚¯ã‚ª', hiragana: 'ããŠ' }, 'ho': { katakana: 'ãƒ›ãƒ¼', hiragana: 'ã»ãƒ¼' }, 'leung': { katakana: 'ãƒªãƒ§ãƒ³', hiragana: 'ã‚Šã‚‡ã‚“' }, 'liang': { katakana: 'ãƒªãƒ£ãƒ³', hiragana: 'ã‚Šã‚ƒã‚“' }, 'so': { katakana: 'ã‚½ãƒ¼', hiragana: 'ããƒ¼' }, 'su': { katakana: 'ã‚¹ãƒ¼', hiragana: 'ã™ãƒ¼' }, 'yip': { katakana: 'ã‚¤ãƒƒãƒ—', hiragana: 'ã„ã£ã·' }, 'ip': { katakana: 'ã‚¤ãƒƒãƒ—', hiragana: 'ã„ã£ã·' }, 'yeh': { katakana: 'ã‚¤ã‚¨', hiragana: 'ã„ãˆ' }, 'chow': { katakana: 'ãƒãƒ£ã‚¦', hiragana: 'ã¡ã‚ƒã†' }, 'chau': { katakana: 'ãƒãƒ£ã‚¦', hiragana: 'ã¡ã‚ƒã†' }, 'chou': { katakana: 'ãƒãƒ§ã‚¦', hiragana: 'ã¡ã‚‡ã†' }, 'tsang': { katakana: 'ãƒ„ã‚¡ãƒ³', hiragana: 'ã¤ãã‚“' }, 'tseng': { katakana: 'ãƒ„ã‚§ãƒ³', hiragana: 'ã¤ã‡ã‚“' }, 'tang': { katakana: 'ã‚¿ãƒ³', hiragana: 'ãŸã‚“' }, 'teng': { katakana: 'ãƒ†ãƒ³', hiragana: 'ã¦ã‚“' }, 'chung': { katakana: 'ãƒãƒ§ãƒ³', hiragana: 'ã¡ã‚‡ã‚“' }, 'law': { katakana: 'ãƒ­ãƒ¼', hiragana: 'ã‚ãƒ¼' }, 'lo': { katakana: 'ãƒ­ãƒ¼', hiragana: 'ã‚ãƒ¼' }, 'lai': { katakana: 'ãƒ©ã‚¤', hiragana: 'ã‚‰ã„' }, 'liao': { katakana: 'ãƒªãƒ£ã‚ª', hiragana: 'ã‚Šã‚ƒãŠ' }, 'poon': { katakana: 'ãƒ—ãƒ¼ãƒ³', hiragana: 'ã·ãƒ¼ã‚“' }, 'pun': { katakana: 'ãƒ‘ãƒ³', hiragana: 'ã±ã‚“' }, 'pan': { katakana: 'ãƒ‘ãƒ³', hiragana: 'ã±ã‚“' }, 'yiu': { katakana: 'ãƒ¦ã‚¦', hiragana: 'ã‚†ã†' }, 'yao': { katakana: 'ãƒ¤ã‚ª', hiragana: 'ã‚„ãŠ' }, 'yau': { katakana: 'ãƒ¤ã‚¦', hiragana: 'ã‚„ã†' }, 'chiu': { katakana: 'ãƒã‚¦', hiragana: 'ã¡ã†' }, 'siu': { katakana: 'ã‚·ã‚¦', hiragana: 'ã—ã†' }, 'hsiao': { katakana: 'ã‚·ãƒ£ã‚ª', hiragana: 'ã—ã‚ƒãŠ' }, 'fung': { katakana: 'ãƒ•ã‚©ãƒ³', hiragana: 'ãµã‰ã‚“' }, 'feng': { katakana: 'ãƒ•ã‚§ãƒ³', hiragana: 'ãµã‡ã‚“' }, 'kong': { katakana: 'ã‚³ãƒ³', hiragana: 'ã“ã‚“' }, 'chiang': { katakana: 'ãƒãƒ£ãƒ³', hiragana: 'ã¡ã‚ƒã‚“' }, 'tai': { katakana: 'ã‚¿ã‚¤', hiragana: 'ãŸã„' }, 'woo': { katakana: 'ã‚¦ãƒ¼', hiragana: 'ã†ãƒ¼' }, 'hu': { katakana: 'ãƒ•ãƒ¼', hiragana: 'ãµãƒ¼' }, 'lui': { katakana: 'ãƒ«ã‚¤', hiragana: 'ã‚‹ã„' }, 'lu': { katakana: 'ãƒ«ãƒ¼', hiragana: 'ã‚‹ãƒ¼' }, 'yuen': { katakana: 'ãƒ¦ãƒ³', hiragana: 'ã‚†ã‚“' }, 'yuan': { katakana: 'ãƒ¦ã‚¢ãƒ³', hiragana: 'ã‚†ã‚ã‚“' }, 'pang': { katakana: 'ãƒ‘ãƒ³', hiragana: 'ã±ã‚“' }, 'peng': { katakana: 'ãƒãƒ³', hiragana: 'ã½ã‚“' }, 'shum': { katakana: 'ã‚·ãƒ£ãƒ ', hiragana: 'ã—ã‚ƒã‚€' }, 'sum': { katakana: 'ã‚µãƒ ', hiragana: 'ã•ã‚€' }, 'shen': { katakana: 'ã‚·ã‚§ãƒ³', hiragana: 'ã—ã‡ã‚“' }, 'to': { katakana: 'ãƒˆãƒ¼', hiragana: 'ã¨ãƒ¼' }, 'tu': { katakana: 'ãƒˆã‚¥', hiragana: 'ã¨ã…' }, 'tso': { katakana: 'ãƒ„ã‚©', hiragana: 'ã¤ã‰' }, 'cho': { katakana: 'ãƒãƒ§', hiragana: 'ã¡ã‚‡' }, 'tsao': { katakana: 'ãƒ„ã‚¡ã‚ª', hiragana: 'ã¤ããŠ' }, 'ngai': { katakana: 'ã‚¬ã‚¤', hiragana: 'ãŒã„' }, 'wei': { katakana: 'ã‚¦ã‚§ã‚¤', hiragana: 'ã†ã‡ã„' }, 'kwan': { katakana: 'ã‚¯ã‚¡ãƒ³', hiragana: 'ããã‚“' }, 'kuan': { katakana: 'ã‚¯ã‚¢ãƒ³', hiragana: 'ãã‚ã‚“' }, 'fan': { katakana: 'ãƒ•ã‚¡ãƒ³', hiragana: 'ãµãã‚“' }, 'kan': { katakana: 'ã‚«ãƒ³', hiragana: 'ã‹ã‚“' }, 'chien': { katakana: 'ãƒã‚§ãƒ³', hiragana: 'ã¡ã‡ã‚“' }, 'fong': { katakana: 'ãƒ•ã‚©ãƒ³', hiragana: 'ãµã‰ã‚“' }, 'fang': { katakana: 'ãƒ•ã‚¡ãƒ³', hiragana: 'ãµãã‚“' }, 'mak': { katakana: 'ãƒã‚¯', hiragana: 'ã¾ã' }, 'mai': { katakana: 'ãƒã‚¤', hiragana: 'ã¾ã„' }, };
        const romajiToHiraganaMap = { 'a': 'ã‚', 'i': 'ã„', 'u': 'ã†', 'e': 'ãˆ', 'o': 'ãŠ', 'ka': 'ã‹', 'ki': 'ã', 'ku': 'ã', 'ke': 'ã‘', 'ko': 'ã“', 'sa': 'ã•', 'shi': 'ã—', 'su': 'ã™', 'se': 'ã›', 'so': 'ã', 'ta': 'ãŸ', 'chi': 'ã¡', 'tsu': 'ã¤', 'te': 'ã¦', 'to': 'ã¨', 'na': 'ãª', 'ni': 'ã«', 'nu': 'ã¬', 'ne': 'ã­', 'no': 'ã®', 'ha': 'ã¯', 'hi': 'ã²', 'fu': 'ãµ', 'he': 'ã¸', 'ho': 'ã»', 'ma': 'ã¾', 'mi': 'ã¿', 'mu': 'ã‚€', 'me': 'ã‚', 'mo': 'ã‚‚', 'ya': 'ã‚„', 'yu': 'ã‚†', 'yo': 'ã‚ˆ', 'ra': 'ã‚‰', 'ri': 'ã‚Š', 'ru': 'ã‚‹', 're': 'ã‚Œ', 'ro': 'ã‚', 'wa': 'ã‚', 'wo': 'ã‚’', 'n': 'ã‚“', 'ga': 'ãŒ', 'gi': 'ã', 'gu': 'ã', 'ge': 'ã’', 'go': 'ã”', 'za': 'ã–', 'ji': 'ã˜', 'zu': 'ãš', 'ze': 'ãœ', 'zo': 'ã', 'da': 'ã ', 'di': 'ã¢', 'du': 'ã¥', 'de': 'ã§', 'do': 'ã©', 'ba': 'ã°', 'bi': 'ã³', 'bu': 'ã¶', 'be': 'ã¹', 'bo': 'ã¼', 'pa': 'ã±', 'pi': 'ã´', 'pu': 'ã·', 'pe': 'ãº', 'po': 'ã½', 'kya': 'ãã‚ƒ', 'kyu': 'ãã‚…', 'kyo': 'ãã‚‡', 'sha': 'ã—ã‚ƒ', 'shu': 'ã—ã‚…', 'sho': 'ã—ã‚‡', 'cha': 'ã¡ã‚ƒ', 'chu': 'ã¡ã‚…', 'cho': 'ã¡ã‚‡', 'nya': 'ã«ã‚ƒ', 'nyu': 'ã«ã‚…', 'nyo': 'ã«ã‚‡', 'hya': 'ã²ã‚ƒ', 'hyu': 'ã²ã‚…', 'hyo': 'ã²ã‚‡', 'mya': 'ã¿ã‚ƒ', 'myu': 'ã¿ã‚…', 'myo': 'ã¿ã‚‡', 'rya': 'ã‚Šã‚ƒ', 'ryu': 'ã‚Šã‚…', 'ryo': 'ã‚Šã‚‡', 'gya': 'ãã‚ƒ', 'gyu': 'ãã‚…', 'gyo': 'ãã‚‡', 'ja': 'ã˜ã‚ƒ', 'ju': 'ã˜ã‚…', 'jo': 'ã˜ã‚‡', 'bya': 'ã³ã‚ƒ', 'byu': 'ã³ã‚…', 'byo': 'ã³ã‚‡', 'pya': 'ã´ã‚ƒ', 'pyu': 'ã´ã‚…', 'pyo': 'ã´ã‚‡', '-': 'ãƒ¼' };

        // å‡½æ•¸
        function showFeedback(message, type = 'error') {
            validationFeedback.textContent = message;
            validationFeedback.className = `feedback-message ${type}`;
            validationFeedback.style.display = 'block';
        }

        function hideFeedback() {
            validationFeedback.style.display = 'none';
        }

        function preprocessRomaji(text) {
            let processedText = text.toLowerCase().replace(/\s+/g, ''); // ç§»é™¤æ‰€æœ‰ç©ºç™½
            processedText = processedText.replace(/l/g, 'r');
            if (processedText.endsWith('m')) {
                processedText = processedText.slice(0, -1) + 'n';
            }
            return processedText;
        }

        function convertRomajiToHiragana(text) {
            let result = ''; let i = 0;
            while (i < text.length) {
                if (i + 1 < text.length && text[i] !== 'n' && text[i] === text[i+1]) { result += 'ã£'; i++; continue; }
                let sub3 = text.substring(i, i + 3);
                if (romajiToHiraganaMap[sub3]) { result += romajiToHiraganaMap[sub3]; i += 3; continue; }
                let sub2 = text.substring(i, i + 2);
                if (romajiToHiraganaMap[sub2]) { result += romajiToHiraganaMap[sub2]; i += 2; continue; }
                let sub1 = text.substring(i, i + 1);
                if (romajiToHiraganaMap[sub1]) { result += romajiToHiraganaMap[sub1]; i += 1; }
                else { result += sub1; i += 1; }
            }
            return result;
        }

        function convertHiraganaToKatakana(hiragana) {
            return hiragana.replace(/[\u3041-\u3096]/g, match => String.fromCharCode(match.charCodeAt(0) + 0x60));
        }

        function cleanupResult(text) {
            return text.replace(/[a-zA-Z]/g, '');
        }

        function copyToClipboard(text) {
            navigator.clipboard.writeText(text).then(() => {
                showFeedback('å·²è¤‡è£½åˆ°å‰ªè²¼ç°¿ï¼', 'success');
                setTimeout(hideFeedback, 2000);
            });
        }

        // äº‹ä»¶ç›£è½å™¨
        convertBtn.addEventListener('click', () => {
            const lastNameRaw = lastNameInput.value.trim();
            const firstNameRaw = firstNameInput.value.trim();

            if (!lastNameRaw || !firstNameRaw) {
                showFeedback('è«‹åŒæ™‚è¼¸å…¥ã€Œå§“ã€å’Œã€Œåã€çš„è‹±æ–‡æ‹¼éŸ³ã€‚');
                return;
            }
            hideFeedback();
            
            let lastNameHira, lastNameKata, firstNameHira, firstNameKata;
            const lastNameLower = lastNameRaw.toLowerCase();
            if (surnameMap[lastNameLower]) {
                lastNameHira = surnameMap[lastNameLower].hiragana;
                lastNameKata = surnameMap[lastNameLower].katakana;
            } else {
                const lastNameProcessed = preprocessRomaji(lastNameRaw);
                lastNameHira = convertRomajiToHiragana(lastNameProcessed);
                lastNameKata = convertHiraganaToKatakana(lastNameHira);
            }
            
            const firstNameProcessed = preprocessRomaji(firstNameRaw);
            firstNameHira = convertRomajiToHiragana(firstNameProcessed);
            firstNameKata = convertHiraganaToKatakana(firstNameHira);

            app.querySelector('#last-hiragana-result').textContent = cleanupResult(lastNameHira);
            app.querySelector('#last-katakana-result').textContent = cleanupResult(lastNameKata);
            app.querySelector('#first-hiragana-result').textContent = cleanupResult(firstNameHira);
            app.querySelector('#first-katakana-result').textContent = cleanupResult(firstNameKata);

            resultsArea.style.display = 'block';
        });

        clearBtn.addEventListener('click', () => {
            lastNameInput.value = '';
            firstNameInput.value = '';
            resultsArea.style.display = 'none';
            hideFeedback();
        });

        resultsArea.addEventListener('click', (e) => {
            const target = e.target.closest('.result-btn');
            if (!target) return;
            const targetId = target.dataset.target;
            const textEl = app.querySelector(`#${targetId}`);
            if (!textEl) return;
            const text = textEl.textContent;
            if (target.classList.contains('speech-btn')) {
                if (text && window.speechSynthesis) {
                    const utterance = new SpeechSynthesisUtterance(text);
                    utterance.lang = 'ja-JP';
                    window.speechSynthesis.speak(utterance);
                }
            } else if (target.classList.contains('copy-btn')) {
                copyToClipboard(text);
            }
        });
    });
})();
</script>
