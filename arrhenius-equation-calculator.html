<div id="arrhenius-equation-calculator-app">
  
  <h3>Arrhenius Equation Calculator (Ea)</h3>
  
  <div class="aec-state-section">
    <h4>State 1</h4>
    <div class="aec-input-row">
      <label for="aec-k1">Rate Constant (k₁)</label>
      <div class="aec-input-wrapper"> 
        <input type="text" class="aec-input" id="aec-k1" placeholder="e.g., 1.5e-3">
        </div>
       <small class="aec-unit-note">Enter rate constants k₁ and k₂ with consistent units.</small>
    </div>
    <div class="aec-input-row">
      <label for="aec-t1">Temperature (T₁)</label>
       <div class="aec-input-wrapper">
        <input type="text" class="aec-input" id="aec-t1" placeholder="e.g., 25">
        <select class="aec-unit-select" id="aec-unit-t1">
          <option value="K">K</option> <option value="C" selected>°C</option> <option value="F">°F</option>
        </select>
      </div>
    </div>
  </div>
  
  <div class="aec-state-section">
     <h4>State 2</h4>
     <div class="aec-input-row">
      <label for="aec-k2">Rate Constant (k₂)</label>
       <div class="aec-input-wrapper">
        <input type="text" class="aec-input" id="aec-k2" placeholder="e.g., 4.5e-3">
         </div>
       <small class="aec-unit-note"> Ensure T₁ and T₂ are different.</small>
    </div>
     <div class="aec-input-row">
      <label for="aec-t2">Temperature (T₂)</label>
       <div class="aec-input-wrapper">
        <input type="text" class="aec-input" id="aec-t2" placeholder="e.g., 50">
        <select class="aec-unit-select" id="aec-unit-t2">
           <option value="K">K</option> <option value="C" selected>°C</option> <option value="F">°F</option>
        </select>
      </div>
    </div>
  </div>

  <div id="aec-message-area" class="aec-message"></div>

  <div class="aec-result-group">
    <label for="aec-result-ea">Activation Energy (Ea)</label>
     <div class="aec-output-wrapper">
      <input type="text" id="aec-result-ea" placeholder="---" readonly>
      <select class="aec-unit-select" id="aec-unit-ea-out">
         <option value="kJ/mol" selected>kJ/mol</option>
         <option value="J/mol">J/mol</option>
         <option value="kcal/mol">kcal/mol</option>
         <option value="cal/mol">cal/mol</option>
      </select>
    </div>
  </div>
   
   <small class="aec-constants-note">R ≈ 8.314 J/(mol·K) ≈ 1.987 cal/(mol·K)</small>

</div>

<style>
/* --- 
   Arrhenius Equation Calculator 樣式表 (V1.1 - UI Enhancement)
--- */

#arrhenius-equation-calculator-app {
  background: #ffffff !important;
  border: 1px solid #e2e8f0 !important;
  border-radius: 10px !important;
  padding: 24px !important;
  box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -2px rgba(0, 0, 0, 0.1) !important;
  max-width: 650px !important; 
  margin: 25px auto !important;
  font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Oxygen, Ubuntu, Cantarell, "Open Sans", "Helvetica Neue", sans-serif !important;
  box-sizing: border-box !important;
  /* Grid Layout */
  display: grid !important;
  grid-template-columns: 1fr 1fr !important;
  grid-template-areas: 
    "header header"
    "state1 state2"
    "message message"
    "result result"
    "constants constants";
  gap: 16px 20px !important; 
}

#arrhenius-equation-calculator-app *,
#arrhenius-equation-calculator-app *::before,
#arrhenius-equation-calculator-app *::after {
  box-sizing: inherit !important;
}

/* 標題樣式 */
#arrhenius-equation-calculator-app h3 {
  grid-area: header !important;
  color: #B45309 !important;
  font-size: 24px !important;
  font-weight: 700 !important;
  margin-top: 0 !important;
  margin-bottom: 12px !important; 
  text-align: center !important;
  line-height: 1.3 !important;
}

/* State 區塊 */
#arrhenius-equation-calculator-app .aec-state-section {
  grid-area: auto; /* Let grid place them */
  border: 1px solid #e2e8f0 !important;
  border-radius: 8px !important;
  padding: 16px !important;
}
#arrhenius-equation-calculator-app .aec-state-section:nth-of-type(1) { grid-area: state1 !important; }
#arrhenius-equation-calculator-app .aec-state-section:nth-of-type(2) { grid-area: state2 !important; }

#arrhenius-equation-calculator-app .aec-state-section h4 {
  font-size: 16px !important;
  font-weight: 600 !important;
  color: #334155 !important;
  margin-top: 0 !important;
  margin-bottom: 16px !important;
  text-align: center !important;
}

/* 輸入行 */
#arrhenius-equation-calculator-app .aec-input-row {
  margin-bottom: 16px !important; /* Increased spacing */
}
#arrhenius-equation-calculator-app .aec-input-row:last-child {
    margin-bottom: 0 !important;
}
#arrhenius-equation-calculator-app .aec-input-row label {
  display: block !important;
  font-size: 14px !important;
  font-weight: 600 !important;
  color: #475569 !important;
  margin-bottom: 8px !important;
}

/* --- V1.1 CSS Changes Start --- */

/* Input Wrapper (Now simpler) */
#arrhenius-equation-calculator-app .aec-input-wrapper { 
  display: flex !important;
  align-items: center !important;
  /* Removed border and background from wrapper */
}

/* Input Field Styling (Now with background and border) */
#arrhenius-equation-calculator-app .aec-input {
  flex-grow: 1 !important;
  width: 100% !important; 
  padding: 10px 12px !important;
  font-size: 15px !important;
  font-family: 'Courier New', Courier, monospace !important; 
  font-weight: 600 !important;
  color: #0f172a !important;
  background-color: #f8fafc !important; /* Added background */
  border: 1px solid #cbd5e1 !important; /* Added border */
  border-radius: 8px !important; /* Full radius now */
  margin: 0 !important;
  box-shadow: none !important;
  outline: none !important;
  transition: border-color 0.2s, box-shadow 0.2s !important;
  -moz-appearance: textfield !important;
}
/* Adjust input radius when unit select is present */
#arrhenius-equation-calculator-app .aec-input-wrapper > .aec-input {
  border-top-right-radius: 0 !important; 
  border-bottom-right-radius: 0 !important;
  border-right: none !important; /* Avoid double border */
}


/* Unit Select Styling (Now with matching background/border) */
#arrhenius-equation-calculator-app .aec-unit-select {
  padding: 10px 12px !important;
  font-size: 13px !important; 
  font-family: inherit !important;
  font-weight: 500 !important;
  color: #475569 !important;
  background-color: #f8fafc !important; /* Added background */
  border: 1px solid #cbd5e1 !important; /* Added border */
  border-radius: 0 8px 8px 0 !important; /* Round right */
  margin: 0 !important;
  box-shadow: none !important;
  outline: none !important;
  cursor: pointer !important;
  appearance: none !important; 
  -webkit-appearance: none !important;
  padding-right: 30px !important; 
  background-image: url('data:image/svg+xml;charset=US-ASCII,%3Csvg%20xmlns%3D%22http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg%22%20width%3D%2220%22%20height%3D%2220%22%20fill%3D%22none%22%20viewBox%3D%220%200%2020%2020%22%3E%3Cpath%20stroke%3D%22%2364748b%22%20stroke-linecap%3D%22round%22%20stroke-linejoin%3D%22round%22%20stroke-width%3D%221.5%22%20d%3D%22m6%208%204%204%204-4%22%2F%3E%3C%2Fsvg%3E') !important;
  background-repeat: no-repeat !important;
  background-position: right 8px center !important;
  background-size: 14px 14px !important;
  height: auto !important; /* Let height be determined by content + padding */
  align-self: stretch !important; /* Make sure it fills height */
  min-width: 65px; 
}

/* Focus state for the wrapper */
#arrhenius-equation-calculator-app .aec-input-wrapper:focus-within {
  border-color: transparent !important; /* Hide wrapper border on focus */
  box-shadow: none !important; /* Hide wrapper shadow on focus */
}
#arrhenius-equation-calculator-app .aec-input:focus {
  border-color: #0284c7 !important;
  box-shadow: 0 0 0 3px rgba(2, 132, 199, 0.15) !important;
  position: relative; /* Ensure focus shadow is on top */
  z-index: 1;
}
#arrhenius-equation-calculator-app .aec-unit-select:focus {
  border-color: #0284c7 !important;
  box-shadow: 0 0 0 3px rgba(2, 132, 199, 0.15) !important;
  position: relative; /* Ensure focus shadow is on top */
  z-index: 1;
  border-left-color: #cbd5e1 !important; /* Keep left border */
}
/* --- V1.1 CSS Changes End --- */


/* 單位提示 */
#arrhenius-equation-calculator-app .aec-unit-note {
  display: block !important;
  font-size: 11px !important; 
  color: #64748b !important;
  margin-top: 8px !important;
  text-align: center;
}

/* 訊息區域 */
#arrhenius-equation-calculator-app .aec-message {
  grid-area: message !important;
  font-size: 14px !important;
  font-weight: 500 !important;
  padding: 0 4px !important;
  min-height: 1.5em !important; 
  color: #dc2626 !important; 
  text-align: center !important;
  margin-top: -8px !important; 
}

/* 結果區域 */
#arrhenius-equation-calculator-app .aec-result-group {
  grid-area: result !important;
  margin-top: 0px !important; 
  border-top: 2px dashed #e2e8f0 !important;
  padding-top: 20px !important;
}
#arrhenius-equation-calculator-app .aec-result-group label {
  display: block !important;
  font-size: 16px !important;
  font-weight: 600 !important;
  color: #334155 !important;
  margin-bottom: 10px !important;
  text-align: center !important;
}
/* 唯讀的結果輸出框容器 */
#arrhenius-equation-calculator-app .aec-output-wrapper {
   background-color: #f1f5f9 !important;
   border-color: #d1d5db !important;
}
#arrhenius-equation-calculator-app .aec-output-wrapper:focus-within {
  border-color: #d1d5db !important; 
  box-shadow: none !important;
}
#arrhenius-equation-calculator-app #aec-result-ea[readonly] {
  font-size: 20px !important; 
  font-weight: 700 !important;
  color: #16a34a !important; 
  background: transparent !important;
  cursor: default !important;
  border: none !important; /* Ensure no border */
  border-radius: 8px 0 0 8px !important; 
}
#arrhenius-equation-calculator-app #aec-unit-ea-out {
    min-width: 90px !important; 
    border-radius: 0 8px 8px 0 !important;
    border-color: #d1d5db !important; /* Match output border */
    background-color: #e2e8f0 !important; /* Match output bg */
    border-left: 1px solid #d1d5db !important;
}
#arrhenius-equation-calculator-app #aec-unit-ea-out:focus {
     border-color: #d1d5db !important; 
     box-shadow: none !important;
}


/* 常數提示 */
#arrhenius-equation-calculator-app .aec-constants-note {
  grid-area: constants !important;
  display: block !important;
  text-align: center !important;
  font-size: 12px !important;
  color: #64748b !important;
  margin-top: 0px !important; 
}
</style>

<script>
// Core Spec: IIFE
(function() {

  /**
   * App Main Execution
   */
  function initializeArrheniusCalc() {
  
    // --- Constants ---
    const R_J = 8.314462618;  // J/(mol·K)
    const R_CAL = 1.987204259; // cal/(mol·K)
    
    // R values map for output units
    const R_VALUES = {
        'J/mol': R_J,
        'kJ/mol': R_J / 1000,
        'cal/mol': R_CAL,
        'kcal/mol': R_CAL / 1000
    };

    // --- Get DOM Elements ---
    const appContainer = document.getElementById('arrhenius-equation-calculator-app');
    if (!appContainer) return;
    
    const k1Input = appContainer.querySelector('#aec-k1');
    const t1Input = appContainer.querySelector('#aec-t1');
    const t1Unit = appContainer.querySelector('#aec-unit-t1');
    const k2Input = appContainer.querySelector('#aec-k2');
    const t2Input = appContainer.querySelector('#aec-t2');
    const t2Unit = appContainer.querySelector('#aec-unit-t2');
    
    const resultEa = appContainer.querySelector('#aec-result-ea');
    const eaUnitOut = appContainer.querySelector('#aec-unit-ea-out');
    const messageArea = appContainer.querySelector('#aec-message-area');
    
    // Failsafe check
    if (!k1Input || !t1Input || !t1Unit || !k2Input || !t2Input || !t2Unit || !resultEa || !eaUnitOut || !messageArea) {
        console.error('Arrhenius Calc: Missing UI elements.');
        return;
    }

    // All elements that trigger calculation
    const triggerElements = [k1Input, t1Input, t1Unit, k2Input, t2Input, t2Unit, eaUnitOut];

    /**
     * Helper: Parse input string (allows scientific notation)
     */
    function parseValue(inputStr) {
        const cleanedStr = inputStr.trim().toLowerCase();
        if (cleanedStr === '') return NaN;
        const value = parseFloat(cleanedStr);
        return (isNaN(value) || !isFinite(value)) ? NaN : value;
    }

    /**
     * Helper: Format output value (use scientific notation)
     */
    function formatValue(value) {
        if (isNaN(value) || !isFinite(value)) return '---';
        if (value === 0) return '0';
         return value.toExponential(4); 
    }
    
     /**
     * Helper: Convert temperature to Kelvin
     */
    function toKelvin(temp, unit) {
        temp = parseFloat(temp); 
        if (isNaN(temp)) return NaN;
        if (unit === 'C') return temp + 273.15;
        if (unit === 'F') return (temp - 32) * 5/9 + 273.15;
        return temp; // Already Kelvin
    }
    
    /**
     * Core Function: Calculate Ea
     */
    function calculate() {
        messageArea.textContent = ''; // Clear previous errors
        resultEa.value = '---'; // Clear previous result

        try {
            const k1 = parseValue(k1Input.value);
            const k2 = parseValue(k2Input.value);
            const t1Val = parseValue(t1Input.value);
            const t1UnitVal = t1Unit.value;
            const t2Val = parseValue(t2Input.value);
            const t2UnitVal = t2Unit.value;
            const eaUnitOutVal = eaUnitOut.value;

            // --- Input Validation ---
             // Check if ALL inputs are filled before proceeding
            let allFilled = true;
            if (k1Input.value.trim() === '') allFilled = false;
            if (t1Input.value.trim() === '') allFilled = false;
            if (k2Input.value.trim() === '') allFilled = false;
            if (t2Input.value.trim() === '') allFilled = false;
            
            if (!allFilled) {
                 resultEa.value = '---'; // Keep result blank if not all inputs are filled
                 return; // Exit calculation early
            }
            
            // Now validate the filled values
            if (isNaN(k1) || k1 <= 0) { messageArea.textContent = 'k₁ must be a positive number.'; return; }
            if (isNaN(k2) || k2 <= 0) { messageArea.textContent = 'k₂ must be a positive number.'; return; }
            if (isNaN(t1Val)) { messageArea.textContent = 'Invalid T₁ format.'; return; }
            if (isNaN(t2Val)) { messageArea.textContent = 'Invalid T₂ format.'; return; }
             if (k1 === k2) { messageArea.textContent = 'Rate constants k₁ and k₂ cannot be equal.'; return; }


            // --- Convert Temps to Kelvin ---
            const T1_K = toKelvin(t1Val, t1UnitVal);
            const T2_K = toKelvin(t2Val, t2UnitVal);

             if (isNaN(T1_K) || T1_K <= 0) { messageArea.textContent = 'T₁ must be above absolute zero (0 K).'; return; }
             if (isNaN(T2_K) || T2_K <= 0) { messageArea.textContent = 'T₂ must be above absolute zero (0 K).'; return; }
             if (Math.abs(T1_K - T2_K) < 1e-9) { messageArea.textContent = 'Temperatures T₁ and T₂ must be different.'; return; }

            // --- Select R value based on output unit ---
            const R = R_VALUES[eaUnitOutVal];
            if (!R) { messageArea.textContent = 'Invalid output unit selected.'; return; }

            // --- Calculate Ea using the two-point form ---
            const ln_k2_k1 = Math.log(k2 / k1); 
            const invT1 = 1 / T1_K;
            const invT2 = 1 / T2_K;
            const deltaInvT = invT1 - invT2;

            if (Math.abs(deltaInvT) < 1e-15) { messageArea.textContent = 'Temperatures T₁ and T₂ are too close for accurate calculation.'; return; }

            const Ea = R * ln_k2_k1 / deltaInvT;

            // --- Display Result ---
             if (!isNaN(Ea) && isFinite(Ea)) {
                  resultEa.value = formatValue(Ea);
             } else {
                 messageArea.textContent = 'Calculation resulted in an invalid number.';
             }

        } catch (e) {
            console.error("Arrhenius Calc Error:", e);
            messageArea.textContent = "Calculation error. Check inputs.";
        }
    }

    // --- Attach Event Listeners ---
    triggerElements.forEach(el => {
        el.addEventListener('input', calculate); 
        el.addEventListener('change', calculate); // For selects
    });
    
  } // End initializeArrheniusCalc

  
  // --- Robust Startup Logic ---
  if (document.readyState === 'loading') {
    document.addEventListener('DOMContentLoaded', initializeArrheniusCalc);
  } else {
    initializeArrheniusCalc();
  }

})(); // End IIFE
</script>
